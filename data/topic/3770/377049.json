{"id":377049,"avatar":"//lain.bgm.tv/pic/user/m/000/70/39/703986.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"<div class=\"codeHighlight\"><pre><br>#include <stdio.h><br><br>#define sum_ints(...) sum_int_array((int[]) {__VA_ARGS__}, sizeof((int[]) {__VA_ARGS__}) / sizeof(int))<br>int sum_int_array(int* data, int count) {<br>    int out = 0;<br>    for (int i = 0; i < count; i++) {<br>        out += data[i];<br>    }<br>    return out;<br>}<br><br>int non_constant_test(int a, int b, int c) {<br>    return sum_ints(1, 2, a, b, c);<br>}<br><br><br>/*<br>~~~ sh<br>$ gcc test.c -Wall -Wextra -std=c99 -pedantic && ./a<br>1 + 2 + 3 + 4 + 5 = 15<br>1 + 2 + 1 + 2 + 3 = 9<br>~~~<br>*/<br><br>int main() {<br>    <br>    int sum1 = sum_ints(1, 2, 3, 4, 5);<br>    int sum2 = non_constant_test(1, 2, 3);<br>    // int sum3 = sum_ints(1, 2, 3, 4, 5, \"this will trigger warnings\");<br>    <br>    printf(\"1 + 2 + 3 + 4 + 5 = %d\\n\", sum1);<br>    printf(\"1 + 2 + 1 + 2 + 3 = %d\\n\", sum2);<br>}<br><br></pre></div><br><br><span style=\"text-decoration: line-through;\">赞美 Macro 黑魔法！</span><br>把 sum3 那行的注释去掉就可以看到 gcc 给出警告（虽然很难读），clang 的话则会直接当成错误。<br><br>只适用于 C，因为数组复合字面量严格来说只是 C 的特性， g++ 也不允许取临时数组的地址。<br><br>不建议在实际生产中使用<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"> ","time":"2023-1-20 12:09","title":"类型“安全”的 C 变长参数","userId":"703986","userName":"Letheward","userSign":""}