{"avatar":"//lain.bgm.tv/pic/user/m/000/00/10/1010.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"最近写了个很简单的US脚本是是劫持某个网站的global函数来实现一些自己想要的功能。<br><br>写法来自这里：<a href=\"https://stackoverflow.com/a/21274652\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://stackoverflow.com/a/21274652</a><br><br>完整代码就不贴了，最小化之后就是这样：<br><br><div class=\"codeHighlight\"><pre>// ==UserScript==<br>// @match        https://moca-news.net/*<br>// ==/UserScript==<br><br>addJS_Node(image_load_body);<br>function addJS_Node(text, s_URL, funcToRun, runOnLoad) {<br>    var D = document;<br>    var scriptNode = D.createElement('script');<br>    if (runOnLoad) {<br>        scriptNode.addEventListener(\"load\", runOnLoad, false);<br>    }<br>    scriptNode.type = \"text/javascript\";<br>    if (text) scriptNode.textContent = text;<br>    if (s_URL) scriptNode.src = s_URL;<br>    if (funcToRun) scriptNode.textContent = '(' + funcToRun.toString() + ')()';<br>    var targ = D.getElementsByTagName('head')[0] || D.body || D.documentElement;<br>    targ.appendChild(scriptNode);<br>}<br><br>function image_load_body(art_id, img_id, _mode, _retry) {<br>    console.log('image_load_body replaced');<br>}</pre></div><br><br>我的问题在于，这个脚本在 <br><a href=\"https://moca-news.net/article/20131106/2013110616530a_/image009.html\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://moca-news.net/article/20 ... 530a_/image009.html</a><br>这类网页工作完全正常，<br>但是在 诸如<br><a href=\"https://moca-news.net/imgsearch/?mode=V&seq=20&w=%8D%B2%81X%96%D8%96%A2%97%88&artid=2013110616530a_\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://moca-news.net/imgsearch/ ... tid=2013110616530a_</a><br>这类网页里，我修改过之后的function虽然最后还是可以成功inject（在网页完全load完之后console输入image_load_body显示的是我的修改版而不是原始），但是实际运行的还是在 /large_image.js 里的image_load_body，而不是我的修改版（控制台不会显示'image_load_body replaced'）。<br><br>这俩网页虽然不太一样，但是感觉原理都差不多，不知道为什么一个行一个不行。改了半天run-at 也没用。<br><br>求教！ ","time":"2019-5-25 08:56","title":"User script 开发 / JS问题求助","userId":"fireattack","userName":"烈之斩","userSign":"(V1046-R MAHORO)"}