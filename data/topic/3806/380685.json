{"id":380685,"avatar":"//lain.bgm.tv/pic/user/m/000/29/26/292672.jpg","floor":"#1","group":"宽带综合症候群","groupHref":"/group/download","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/35.jpg","message":"<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"> 在cloudflare workers上部署了一个反代脚本<a href=\"https://gist.github.com/Papersman/64b4c00d7b0a07f458a6966b0eb1ae3e\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">代码链接</a>，可以将https://mikanani.me/RSS的内容和种子下载链接，通过CF的CDN来中转从而实现国内正常访问。对于一些不太好设置代理的下载程序，可以使用这个方法。<br><br><span style=\"font-size:25px; line-height:25px;\"><span style=\"font-weight:bold;\">具体用法</span></span><br><br>注意：这个脚本<span style=\"font-weight:bold;\">仅能</span>用来代理RSS和下载链接，并<span style=\"font-weight:bold;\">不能</span>用来访问这些网站本身。如果是需要访问蜜柑计划等网站的话，可以参考隔壁<a href=\"https://github.com/EstrellaXD/Auto_Bangumi/issues/196\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">autoBangumi</a>的方法<br><br>在原来的RSS链接前面加上<div class=\"codeHighlight\"><pre> https://mikan.noisy01.ml/</pre></div> 即可。<br>举个例子，如果原来的链接是 <a href=\"https://mikanani.me/RSS/Bangumi?bangumiId=681&subgroupid=162\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://mikanani.me/RSS/Bangumi?bangumiId=681&subgroupid=162</a>，将其替换为 <a href=\"https://mikan.noisy01.ml/https://mikanani.me/RSS/Bangumi?bangumiId=681&subgroupid=162\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://mikan.noisy01.ml/https://mikanani.me/RSS/Bangumi?bangumiId=681&subgroupid=162</a> ，即可正常使用。<br><br>目前支持：蜜柑计划，萌番组，acg.rip，dmhy<br><br>确认不可用：nyaa（错误429）<br><br>这个脚本可以反代任何RSS链接（或者其他静态资源），并且可以专门将这几个下载站的RSS中种子的下载链接修改为使用反代地址的链接。如果你订阅的站点RSS中，下载链接是以磁力链接形式提供的，一般来说也可以使用这个脚本。<br><br>由于cloudflare workers免费版每日有10w次请求的限额，因此如果要大量使用的话，建议自己部署：<br><br><span style=\"font-size:25px; line-height:25px;\"><span style=\"font-weight:bold;\">部署方法</span></span><br><br>1. 必须为workers准备一个域名（因为他默认的xxx.workers.dev 本身也是被屏蔽的<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\">），域名必须是位于你自己的cloudflare账号下的，可以从其他域名平台转移过去，具体请自行搜索一下。搞定之后自己想一个比较好记的二级域名，作为接下来给worker使用的域名，先记下来（以mikan.xxx.com为例）<br><br>2.登录 <a href=\"https://dash.cloudflare.com/\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://dash.cloudflare.com/</a> ，没有账号的话注册一下。点击右侧<span style=\"font-weight:bold;\">Workers</span>，然后直接选择<span style=\"font-weight:bold;\">Create Worker</span>。这个时候会打开一个类似文本编辑器的页面，将<a href=\"https://gist.github.com/Papersman/64b4c00d7b0a07f458a6966b0eb1ae3e\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">gist</a>里的代码复制进去，然后把代码中所有的 <span style=\"text-decoration: underline;\">your.workers.dev</span> 替换为第一步所说的那个域名（以mikan.xxx.com为例）<br><br>3.点击<span style=\"font-weight:bold;\"> Save and deploy</span>,确认并部署，现在再次点击侧面的workers，网页中间就有刚才部署完成的worker，点进去，选择Triggers（触发器）-> Custom Domains（自定义域）-> add custom Doamin，输入刚刚所说的域名（以mikan.xxx.com为例），然后添加即可。如果显示红色错误提示，说明你的域名还没有转移到cloudflare中，可自行搜索如何转移。<br><br>4.现在就可以使用和上面一样的方法来反代蜜柑了。<br><br><span style=\"font-size:25px; line-height:25px;\"><span style=\"font-weight:bold;\">反代其他RSS</span></span><br><br>如果你需要反代其他RSS站点，可以模仿<div class=\"codeHighlight\"><pre>if (url.includes('mikanani.me/RSS')) {</pre></div> 这部分内容自行修改。<br><br>如前文所述，如果你的RSS中，下载链接是以磁力链接的形式提供的，那么一般来说你可以不用做任何修改，直接就能用。但是如果你的RSS中，下载链接是以种子的形式提供的，那么你需要进行如下的修改，以acg.rip为例演示一下（<span style=\"font-weight:bold;\">必须自己部署</span>的情况下才可以）：<br><br>浏览器访问acg.rip的任意RSS链接（例如 <a href=\"https://acg.rip/.xml?term=%E6%B0%B4%E6%98%9F%E7%9A%84%E9%AD%94%E5%A5%B3\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://acg.rip/.xml?term=%E6%B0%B4%E6%98%9F%E7%9A%84%E9%AD%94%E5%A5%B3</a>），打开之后你会看到类似下面这样的xml文件结构：<br><div class=\"codeHighlight\"><pre><item><br><title>[喵萌奶茶屋&LoliHouse] 机动战士高达 水星的魔女 / Mobile Suit Gundam THE WITCH FROM MERCURY - 14 [WebRip 1080p HEVC-10bit AAC][简繁日内封字幕]</title><br><description><img src=\"https://nekomoe.pages.dev/images/2022-10/w1000/g-witch_1000.png\" alt=\"\" /><br /> <br /> <strong>机动战士高达 水星的魔女 / Mobile Suit Gundam THE WITCH FROM MERCURY</strong><br /> <strong>字幕：喵萌奶茶屋</s...</description><br><pubDate>Sun, 16 Apr 2023 15:29:28 -0700</pubDate><br><link>https://acg.rip/t/277700</link><br><guid>https://acg.rip/t/277700</guid><br><enclosure url=\"https://acg.rip/t/277700.torrent\" type=\"application/x-bittorrent\"/><br></item></pre></div><br>我们重点关注两个事情，第一个是当前所访问的网址，即 <span style=\"text-decoration: underline;\">RSS链接</span>本身，这个需要被反代，另一个是 <span style=\"text-decoration: underline;\">torrent文件链接</span>，一般前者进不去的话，后者也下不下来，因此需要把他的链接重写为使用反代的链接。<br><br>由于不同的BT站的具体链接不同，所以你需要修改代码中 84行 开始的这段判断语句：<br><div class=\"codeHighlight\"><pre>            // 当访问mikanani.me/RSS的时候，将返回的xml中的mikanani.me替换<br>            if (url.includes('mikanani.me/RSS')) {  //链接如果包含这个字段，就进行对应的替换<br>                const response = await fetch(url, fp);<br>                const text = await response.text();<br>                outBody = text.replace(/mikanani.me\\/Download\\//g, 'your.workers.dev/https://mikanani.me/Download/');  //将RSS返回的内容中的下载链接也替换掉<br>                outCt = response.headers.get('content-type');<br>                outStatus = response.status;<br>                outStatusText = response.statusText;<br><br>            } else {<br>                outBody = fr.body;<br>                outStatus = fr.status;<br>                outStatusText = fr.statusText;<br>            };</pre></div><br>参考acgrip的RSS的结果，我们添加一个else if条件，修改为：<br><div class=\"codeHighlight\"><pre>            // 当访问mikanani.me/Download的时候，将返回的xml中的mikanani.me替换<br>            if (url.includes('mikanani.me/RSS')) {<br>                const response = await fetch(url, fp);<br>                const text = await response.text();<br>                outBody = text.replace(/mikanani.me\\/Download\\//g, 'your.workers.dev/https://mikanani.me/Download/');<br>                outCt = response.headers.get('content-type');<br>                outStatus = response.status;<br>                outStatusText = response.statusText;<br><br>            } else if (url.includes('acg.rip/.xml')) {  //当访问acg.rip/.xml的时候，将返回的xml中的acg.rip/t/替换<br>                const response = await fetch(url, fp);<br>                const text = await response.text();<br>                outBody = text.replace(/acg.rip\\/t\\//g, 'your.workers.dev/https://acg.rip/t/');  //将RSS返回的内容中的下载链接 acg.rip/t/ 替换为 your.workers.dev/https://acg.rip/t/ ，注意使用 \\/ 来转义 /<br>                outCt = response.headers.get('content-type');<br>                outStatus = response.status;<br>                outStatusText = response.statusText;<br>            } else {<br>                outBody = fr.body;<br>                outStatus = fr.status;<br>                outStatusText = fr.statusText;<br>            };</pre></div><br>这样就可以了。 ","time":"2023-4-21 22:18","title":"蜜柑计划RSS无法访问的解决办法","userId":"arcticwind","userName":"Arcticwinds","userSign":"(失去的肢体，阵亡的战友……残存的幻痛不曾停息 ... ... ...)"}