{"id":364019,"avatar":"//lain.bgm.tv/pic/user/m/000/09/57/95768.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"<span style=\"color: red;\"><span style=\"font-size:16px; line-height:16px;\">测试是否有效</span></span><br>鉴于楼下有质疑这个方法的童鞋，我做了一下测试。使用的 Firefox 测试。 UA 使用的 Chrome。<br><img src=\"https://tvax3.sinaimg.cn/large/63ef482dly1gslzrnnfv1j21hc0snwsq.jpg\" class=\"code\" alt><br>按照下面的方法我设置好了 UA，并成功登录 Bangumi。见截图<br><img src=\"https://tva1.sinaimg.cn/large/63ef482dly1gsm0558k31j21hc0sn4nt.jpg\" class=\"code\" alt><br><br>然后我去 Firefox 的 ftp 下载了 beta 版本，并设置配置文件为之前的配置<br><img src=\"https://tvax4.sinaimg.cn/large/63ef482dly1gsm071oxpbj20q30j8juf.jpg\" class=\"code\" alt><br><img src=\"https://tva3.sinaimg.cn/large/63ef482dly1gsm07fbu7nj20iw0qnwkg.jpg\" class=\"code\" alt><br><br>再次启动后依然能够正常访问 Bangumi，登录信息仍然存在。<br><img src=\"https://tva3.sinaimg.cn/large/63ef482dly1gsm0l09hcnj21hc0sn7se.jpg\" class=\"code\" alt><br><span style=\"color: green;\"><span style=\"font-size:16px; line-height:16px;\">测试使用本地代码访问</span></span><br><img src=\"https://tvax2.sinaimg.cn/large/63ef482dly1gsm0anmo7jj21hc0scwvv.jpg\" class=\"code\" alt><br>源码地址：<br><a href=\"https://github.com/22earth/blog/blob/master/demos/test-node/src/bangumi-test.ts\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://github.com/22earth/blog/ ... src/bangumi-test.ts</a><br><br>有些网站在检测用户身份的时候用到了 HTTP 请求头 <span style=\"font-weight:bold;\">User-Agent</span>。<br>当浏览器自动升级后，User-Agent 发生变化，导致用户认证失败，需要重新登录。<br>所以保持登录状态的一个小技巧就是保持 <span style=\"color: red;\">User-Agent</span> 不变。<br>对于 Cookie 过期的需要重新登录的问题，这里就不讨论了。<br><br>我使用的这个浏览器扩展： <a href=\"https://chrome.google.com/webstore/detail/header-editor/eningockdidmgiojffjmkdblpjocbhgh?hl=zh-CN\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">Header Editor</a><br><br>当然使用其它扩展也行比如： <a href=\"https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg?hl=zh-CN\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">User-Agent Switcher</a><br><br>关键点就是保持网站 User-Agent 不变就行。<br><br><span style=\"color: red;\"><span style=\"font-size:16px; line-height:16px;\">以 Header Editor 为例子</span></span><br>添加规则页面<br><img src=\"https://tva4.sinaimg.cn/large/63ef482dly1gskypwhxfvj21hc0pnjvm.jpg\" class=\"code\" alt><br>匹配规则填写： <span style=\"color: tomato;\">bgm\\.tv|bangumi\\.tv|chii\\.in</span><br>可以根据需要增加其它网站比如我的规则： <span style=\"color: tomato;\">bgm\\.tv|kfmax\\.com|south-plus\\.net</span><br>绯月、南+ 也是 User-Agent 变动后会掉登录的网站<br><br>头名称:  <span style=\"color: tomato;\">user-agent</span><br>头内容:  Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36<br><br>上面的头内容是我自己的，头内容根据实际填写。<br>可以通过 F12 利用控制台，输入  <span style=\"font-weight:bold;\">copy(navigator.userAgent)</span>   复制。<br><img src=\"https://tvax4.sinaimg.cn/large/63ef482dly1gskyor7bykj20lg06sdgi.jpg\" class=\"code\" alt><br><br><span style=\"color: red;\"><span style=\"font-size:16px; line-height:16px;\">利用 Header Editor 重定向 Bangumi 域名</span></span><br><br>HE(Header Editor) 的用途还有很多，图片防盗链、重定向、控制网站响应语言等，这里再举个我用到的例子。<br>外部访问 Bangumi 时，重定向为常用的域名。<br><img src=\"https://tva4.sinaimg.cn/large/63ef482dly1gskzz8gywjj211o0kndhz.jpg\" class=\"code\" alt><br>我常用的是 bgm.tv 这个域名<br>匹配规则：<br><div class=\"codeHighlight\"><pre><br>^https?://(doujin.)?(?:bangumi|chii).(?:tv|in)/(.*$)<br></pre></div><br>重定向至：<br><div class=\"codeHighlight\"><pre><br>https://$1bgm.tv/$2<br></pre></div><br><br>如果你是使用的  bangumi.tv 这个域名<br>匹配规则：<br><div class=\"codeHighlight\"><pre><br>^https?://(doujin.)?(?:bgm|chii).(?:tv|in)/(.*$)<br></pre></div><br>重定向至：<br><div class=\"codeHighlight\"><pre><br>https://$1bangumi.tv/$2<br></pre></div><br><br>chii.in 这个域名就不举例了，匹配规则取消 chii.in ，重定向规则改成 chii.in ","time":"2021-7-18 12:45","title":"解决 Bangumi 网页端掉登录小技巧（增加测试截图，注意多图）","userId":"a_little","userName":"拿月亮自刎","userSign":"(情更怯)"}