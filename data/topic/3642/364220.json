{"id":364220,"avatar":"//lain.bgm.tv/pic/user/m/000/31/77/317704.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"最近遇到了一个和 Emoji 相关的奇妙问题，在此分享一下自己的探索过程，以及期望能得到一些指点。<br><br>起源是发现 ©️ 这个 Emoji 在不同浏览器中的显示不一样。在 Chrome 系下就是一个单纯的文本字符，但是在 Firefox 中就会显示为一个 Emoji （圆圈内有白色底色）。进一步探索，发现 Emoji 实际上有两种 presentation：text 和 emoji (也称作 pictographic)（<a href=\"https://emojipedia.org/glossary/#emoji-presentation\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">Link</a>）。Unicode 中规定了 VS15 和 VS16 （VS=Variation Selector），实际上是两个特殊的 Unicode 码点（ U+FE0E 和 U+FE0F），追加在 Emoji 后可以强制指定要显示哪种 presentaion。如果不在 Emoji 字符后追加 VS，那么默认的 presentation 是系统/环境特定的。比较新的 emoji 基本上只有 emoji presentation，但是老的 emoji（包括部分从 wingding 继承过来的），就同时有 text 和 emoji presentation。<br>（<a href=\"https://character.construction/emoji-vs-text\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">所有 emoji 的 Presentation 展示</a>，网页较大，请用 Firefox 打开，可能导致 Chrome 崩溃。）<br><br>然而追加 VS16（即要求使用 emoji presentation），只能解决部分 Emoji 在 Chrome 下调用 text presentation 的问题，有的 Emoji 依然不会调用 emoji presentation。<br>（前者没有加 VS16，后者加了 VS16）<br>可以要求调用 emoji： ⛰ ⛰️<br>不能要求调用 emoji：© ©️<br><br>预期：在任何浏览器上，第二个 emoji 都应该以 emoji 图像的形式显示<br>实际：Firefox 正常，Chrome 系 Copyright 加了 VS16 也不会显示为 emoji。<br>（工具：<a href=\"https://bencrowder.github.io/unicode-inspector/\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">Unicode Inspector</a>）<br><br>进一步调查，发现可能和浏览器的字体回退机制有关。（<a href=\"https://www.reddit.com/r/firefox/comments/e048ih/bug_firefox_7001_those_emojis_do_not_have/\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">Reddit 讨论</a>）具体而言，在 Chrome 上，如果 CSS 里写的是 SYSTEM-UI 的话，Windows 10 下会被解析到 Segoe UI，但这个字体对 Emoji 的支持是不完整的，即便追加了 VS16 也无法解析到 Copyright 这个 emoji 的 emoji presentation，最后回落到了 text presentation。但是在 Firefox 上，对 emoji 有特定处理，emoji 会被解析到 Segoe UI Emoji，从而能正常显示。<br><br>（<span style=\"text-decoration: line-through;\">豆知识：如果在网页里用了 Emoji，为了确保 Windows 10 + Chrome 用户能正常显示，请在 CSS 中把 Segoe UI Emoji 放在 SYSTEM-UI 或类似的字体家族之前。</span> 不要这样做，不然文字显示也会受到影响。Segoe UI Emoji 里不仅有 Emoji，也有正常字符。）<br><br>到这里逻辑链条似乎都很正常，但是似乎继续深究下去就出现了奇怪的问题。以阴阳（☯，☯️，U+262F）这个 emoji 为例子，如果在 notepad 中直接复制，显示的 glyph （字形） 是一个带黑框，阴阳两点在纵轴的 text presentation。用 FontForge 打开各个字体文件检查，可以发现这个glyph 来自于 Segoe UI Emoji。notepad 默认字体是微软雅黑，但是检查 NT 系统的字体回退机制（<a href=\"https://samcui.com/post/windows-nt-fonts-fallback-about-wtp-and-itunes/\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">Link</a>），可以发现 Microsoft YaHei 这个字体的回退项并不包括 Segoe UI Emoji。所以这个字形到底是怎么被选中的？<br><br>希望各位能提供一些思路。 ","time":"2021-7-31 20:49","title":"Emoji 与字体回退？","userId":"317704","userName":"NekoNull","userSign":""}