{"id":368869,"avatar":"//lain.bgm.tv/pic/user/m/000/13/30/133075.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"想在爬图片的时候把图片压缩一下，于是使用了opencv库cv2<br><br>压缩只需要使用 img = cv2.resize(img, (width, height),interpolation=cv2.INTER_AREA)<br><br>但是opencv 读取/保存图片的常用函数：cv2.imread(img_path) 和 cv2.imwrite(img_path, img) 在img_path含有中文时会出错<br><br>尝试解决方法：<br>1. 使用 imdecode 和 imencode<br>cv2.imdecode(np.fromfile(img_path,dtype=np.uint8), -1)<br>cv2.imencode('.jpg', img)[1].tofile(img_path)<br>不足之处：<br>cv2.imwrite可以设定保存JPG图片的质量，比如：<br>cv2.imwrite(img_path,img,[int(cv2.IMWRITE_JPEG_QUALITY),90])<br>而cv2.imencode没有设定保存质量的参数<br><br>2. 使用shutil.move 把中文路径的图片移动/重命名到非中文路径，再使用cv2.imread/cv2.imwrite<br>不足之处：<br>增加了不必要的磁盘操作，效率更低<br><br>3. 使用PIL库，互相转换<br>cv2PIL:   Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))<br>PIL2cv:   cv2.cvtColor(np.array(img), cv2.COLOR_RGB2BGR)<br><br>等等，既然都用上PIL了，那还要cv2干什么<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"><br><br>压缩直接用  img = img.resize((width, height),Image.BILINEAR)<br>也可以设定保存JPG图片的质量<br>img.save(img_path, format='JPEG', quality=90)<br>当然，中文路径也是没问题的，这样问题就解决了<img src=\"/img/smiles/tv/16.gif\" smileid=\"55\" alt=\"(bgm39)\"><br><br>不过需要注意，将png格式的图片保存为jpg格式，如果直接使用 save() 方法就会出现错误：<br>OSError: cannot write mode RGBA as JPEG<br>要先转变为三通道 RGB 模式<br>img = img.convert('RGB') ","time":"2022-4-12 20:56","title":"[python] 关于我想用cv2压缩图片最终却选择了PIL这回事","userId":"liaune","userName":"君寻","userSign":"(学会欣赏不完美)"}