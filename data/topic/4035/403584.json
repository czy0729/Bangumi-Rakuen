{"id":403584,"avatar":"//lain.bgm.tv/pic/user/m/000/89/22/892208.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"在Ubuntu22.04LTS(X86_64)上安装Anbox会出现各种问题，不是安装文件丢失就是编译器版本过新，代码不能用。我现在解决了大部分问题，就差最后那个ashmem安装不上，我看百度贴吧Anbox吧已经凉了，希望这里会有人帮我吧。<br>懒得再去snap上下载了，我选择搬仓库源码编译。<br>首先是把仓库搬下来。<br>国内搬github仓库很慢，安装一下fastgithub加速clone速度。<br><div class=\"codeHighlight\"><pre><br>cd+~<br>wget+https://gitee.com/chcrazy/FastGithub/releases/download/2.1.4/fastgithub_linux-x64.zip<br>7z+x+fastgithub_linux-x64.zip<br>cd+fastgithub_linux-x64<br>./fastgithub<br></pre></div><br>然后手动配置一下代理到<a href=\"http://127.0.0.1:38457\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">http://127.0.0.1:38457</a><br>完成<br>然后需要安装一下前置<br><div class=\"codeHighlight\"><pre><br>sudo+apt+install+build-essential+cmake+cmake-data+debhelper+dbus+google-mock+\\<br>++++libboost-dev+libboost-filesystem-dev+libboost-log-dev+libboost-iostreams-dev+\\<br>++++libboost-program-options-dev+libboost-system-dev+libboost-test-dev+\\<br>++++libboost-thread-dev+libcap-dev+libexpat1-dev+libsystemd-dev+libegl1-mesa-dev+\\<br>++++libgles2-mesa-dev+libglm-dev+libgtest-dev+liblxc1+\\<br>++++libproperties-cpp-dev+libprotobuf-dev+libsdl2-dev+libsdl2-image-dev+lxc-dev+\\<br>++++pkg-config+protobuf-compiler+python3-minimal<br></pre></div><br>下面是clone仓库和编译过程<br><div class=\"codeHighlight\"><pre><br>cd+~<br>git+clone+https://github.com/anbox/anbox.git+--recurse-submodules<br>cd+anbox<br></pre></div><br>之后你可以选择手动一点或者自动一点<br>自动：<br><div class=\"codeHighlight\"><pre><br>./build.sh<br></pre></div><br>手动：<br><div class=\"codeHighlight\"><pre><br>mkdir+build<br>cmake+..<br>make<br>make+install<br></pre></div><br>到这里就基本完成了<br>出现的问题可能有：<br>+1.cmake阶段有文件缺失:<br>++检查git+clone最后有没有加--recurse-submodules<br>++检查网络环境，fastgithb是否正确启动，网络全局代理是否启用<br>+2.make出现:<br><div class=\"codeHighlight\"><pre><br>[src/CMakeFiles/anbox-core.dir/build.make:1268：src/CMakeFiles/ax-core.dir/anbox/platform/sdl/window.cpp.o]+错误+1<br></pre></div><br>+重新安装SDL<br>最后，install完无法启动？<br>检查环境：<br><div class=\"codeHighlight\"><pre><br>anbox+check-features<br></pre></div><br>检查两个设备：<br><div class=\"codeHighlight\"><pre><br>ls+/dev/{binder,ashmem}<br></pre></div><br>有输出才是正确的<br>没有这两个设备请看：<br><div class=\"codeHighlight\"><pre><br>cd+~<br>git+clone+https://github.com/anbox/anbox-modules.git<br>cd+anbox-modules<br>sudo+cp+anbox.conf+/etc/modules-load.d/<br>sudo+cp+99-anbox.rules+/lib/udev/rules.d/<br>sudo+cp+-rT+ashmem+/usr/src/anbox-ashmem-1<br>sudo+cp+-rT+binder+/usr/src/anbox-binder-1<br>sudo+dkms+install+anbox-ashmem/1+//我在这步出问题<br>sudo+dkms+install+anbox-binder/1<br>sudo+modprobe+ashmem_linux<br>sudo+modprobe+binder_linux<br>lsmod+|+grep+-e+ashmem_linux+-e+binder_linux<br>ls+-alh+/dev/binder+/dev/ashmem<br></pre></div><br>ashmem怎么安装？<br>正常来说到~/anbox-modules/ashmem下make+&+make+install就好了<br>我在make时遇到两个编译错误:<br><div class=\"codeHighlight\"><pre><br>/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:+In+function+‘ashmem_mmap’:<br>/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:393:23:+error:+assignment+of+read-only+member+‘vm_flags’<br>++393+|+++++++++vma->vm_flags+&=+~calc_vm_may_flags(~asma->prot_mask);<br>+++++++++|+++++++++++++++++++++++++++++++++++^~<br>/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:+In+function+‘ashmem_init’:<br>/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:877:9:+error:+too+few+arguments+to+function+‘register_shrinker’<br>++877+|+++++++++register_shrinker(&ashmem_shrinker);<br>+++++++++|+++++++++^~~~~~~~~~~~~~~~~<br></pre></div><br>很是棘手啊，源代码有问题！<br>/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:877:9这个问题我通过修改源代码成功解决，原因在于gcc从不知道哪个版本开始，register_shrinker函数变成两个输入了。所以把<br><div class=\"codeHighlight\"><pre><br>register_shrinker(&ashmem_shrinker);<br></pre></div><br>修改为<br><div class=\"codeHighlight\"><pre><br>register_shrinker(&ashmem_shrinker,+\"ashmem\");<br></pre></div><br>即可，可是。。。<br>上面那个/home/sakitsuki_asahi/anbox-modules/ashmem/ashmem.c:393:23问题还没法解决。<br>上网查了一圈，没人和我有一样的问题。。。<br>官方github项目早在今年2月份就已经被archive了，我也提交不上issue。<br>现来求助！<br>求求了！","time":"2024-8-12 15:19","title":"Anbox，我真的谢谢你","userId":"sakitsuki_asahi","userName":"崎月朝日","userSign":"(话语总是难以诉之于口,它们在心中不断积聚,愈发强烈。)"}