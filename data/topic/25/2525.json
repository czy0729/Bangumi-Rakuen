{"id":2525,"avatar":"//lain.bgm.tv/pic/user/m/icon.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"昨晚rss了konachan 早上起来无比蛋疼 .. 一个一个下载很麻烦 于是就开工了<br><br>嘛 昨天分析了hongfire的某页面提取了80+个mediafire的链接 . 于是灵感是这里来的 ..<br><br>大概说下运行顺序<br><br>首先 下载页面post主页 然后查找规律 找到后通过grep awk sed等一些列工具处理得到我需要的内容<br><br>然后就调用aria2c或者wget下载壁纸 默认会建立$HOME/.konachan和$HOME/Pictures/Konachan来存放需要的资料和下载完的壁纸<br><br><br>壁纸挑选了原图 绝对不是预览什么的 .. 使用diff来分辨已经下载和新的图片<br><br>问题在于分类tag来分类的话 虽然能做到不过不是一般的麻烦 （毕竟是用脚本不是程序啊<br><br>而且一张图N多tag ... 于是默认使用2010-06-24-4来分类了 .. 按照日期<br><br>最后丢到cron里去每小时执行一次<br><br>#/bin/bash<br><br>dir=$HOME/.konachan/<br><br>storedir=$HOME/Pictures/Konachan/<br><br>if [ -e \"${dir}\"  ]<br>        then<br>        echo -e \"Directory exist\"<br>        else<br>                mkdir \"${dir}\"<br>                fi<br><br>if [ -e \"${storedir}\" ]<br>        then<br>        echo -e \"Place to store ready\"<br>        else<br>                mkdir \"${storedir}\"<br>                fi<br><br>wget <a href=\"http://konachan.com/post\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">http://konachan.com/post</a> -O \"${dir}\"post<br><br>fold=$(date +%F-%w)<br><br>mkdir \"${storedir}\"\"${fold}\" 2> /dev/null<br><br>touch \"${dir}\"store.old<br><br>mv \"${dir}\"store \"${dir}\"store.old<br><br>org=$(cat \"${dir}\"post | grep konachan.com/post/show | sed 's/.*pl //g' | sed 's/<.*//g')<br><br>echo \"${org}\" > \"${dir}\"store<br><br>comp=$(diff \"${dir}\"store \"${dir}\"store.old | grep \\< | sed 's/<//g')<br><br>if [ -z \"${comp}\" ]<br>        then<br>        echo -e \"No New wallpaper\"<br>        else<br>                echo -e \"Downloading New Wallpaper\"<br>               <br>                echo \"${comp}\" | while read item<br>                        do<br>                                getpic=$(cat \"${dir}\"post | grep \"${item}\" | sed 's/.*pl //g' | grep kuro.hanyuu.net/image | sed 's/.*f=\"//g' | sed 's/\".*//g')<br>                                for  var in $getpic<br>                                do<br>                                                aria2c $var<br>                                                done<br>                                                done<br>                                                fi<br><br>file=$(ls Konachan* 2> /dev/null )<br><br>echo \"${file}\" | while read image<br>        do<br>                mv \"${image}\" \"${storedir}\"\"${fold}\" 2> /dev/null<br>                done<br><br>rm \"${dir}\"post<br><br><br>代码简陋 大家看看就好<br><br>保存之后chmod +x xxx就可以了 ..<br><br>上面贴的是下载konachan.com的 .. 其实萌妹也差不多 打包丢下面<br><br><a href=\"http://filer.blogbus.com/4828531/resource_482853112773631350.bz2\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">下载点我 （别动我 缩</a> ","time":"2010-6-24 17:08","title":"自动下载萌妹 konachan壁纸script","userId":"wudaown","userName":"wudaown","userSign":""}