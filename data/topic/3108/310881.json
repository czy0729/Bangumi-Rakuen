{"id":310881,"avatar":"//lain.bgm.tv/pic/user/m/000/06/82/68264.jpg","floor":"#1","group":"站务论坛","groupHref":"/group/forum","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/2.jpg","message":"就是给bgm写用户脚本...让自己用着舒服些...结果把自己的bgm首页弄瘫了<br><br>检查后发现问题是这样发生的:<br><br>我想为我脚本增加一个配置的功能.<br>我觉得作为首页的一个可拖动的模块挺不错的.<br>于是模仿HTML用脚本给首页增加了一个模块, 如图:<br><img src=\"http://ww2.sinaimg.cn/large/627ab2d1gw1et2pk5xnbpj209605fjrv.jpg\" class=\"code\" alt><br><br>代码如下:<br><div class=\"codeHighlight\"><pre>$('div.sideInner').append(<br>$('<div id=\"mokuai\" class=\"halfPage sort ui-draggable\"><div class=\"sidePanelHome\"><h2 class=\"subtitle\">测试模块</h2></div></div>'));</pre></div><br><br>既然是可拖动的模块自然是要<span style=\"font-weight:bold;\">拖动</span>测试一下...然后问题发生了:<br>每次拖动后BGM都会为用户保存模块的位置...<br>这次也不例外,而且也把我添加的模块的模块也保存上去了!<br><img src=\"http://ww4.sinaimg.cn/large/627ab2d1gw1et2pk5tpl8j20jw02aaag.jpg\" class=\"code\" alt><br><br>然后再次刷新首页就半瘫了...<br>因为有一个模块(我添加的模块)不能成功加载导致页面大部分的JS功能都无效了<br><img src=\"http://ww2.sinaimg.cn/large/627ab2d1gw1et2pk61emcj209d04r3yw.jpg\" class=\"code\" alt><br><br>临时的解决办法是用xhr模拟正常的请求发送过去,代码如下:<br><div class=\"codeHighlight\"><pre>var xhr = new XMLHttpRequest();<br>xhr.open('POST', '/update/user/index', true);<br>xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\")<br>xhr.send('page_setting=l:;r:home_grp_tpc,home_subject_tpc,home_tml,home_calendar,home_announcement');<br>xhr.onload = function(){ console.log('重置成功'); };</pre></div><br><br>不知道这问题大大们会不会跟进一下...但我是觉得有必要说出来一下的...<img src=\"/img/smiles/tv/06.gif\" smileid=\"45\" alt=\"(bgm29)\"> ","time":"2015-6-13 19:58","title":"写用户脚本的时候不小心首页弄半瘫了","userId":"zheung14","userName":"DanoR","userSign":"(没有耐心的\"观众\"们...浮躁得过分 ...)"}