{"avatar":"//lain.bgm.tv/pic/user/m/000/13/14/131492.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"我按照<a href=\"http://www.runoob.com/w3cnote/android-tutorial-socket1.html\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">网上的教程</a>写了一个socket测试程序 <br><br>socket服务器用php脚本写的在运行     √<br>在新线程里进行网络操作                     √<br>在AndroidMainFast里添加网络权限     √<br><br>但是不知道为什么每次线程执行到socket = new socket(host,ip)的时候就卡住了，按步执行走到那里也不知道光标跳到那里去了...<img src=\"/img/smiles/tv/19.gif\" smileid=\"58\" alt=\"(bgm42)\">然后点发送的时候socket还是null自然程序就闪退了...<br><br>和同学搞创新项目打算做一个基于地图的留言探索app，都是安卓初心者也不知道通信方法是用socket还是http还是别的什么好，想求一些建议<img src=\"/img/smiles/tv/10.gif\" smileid=\"49\" alt=\"(bgm33)\">（安卓上的socket有轮子吗？）<br><br>附上code<br><div class=\"codeHighlight\"><pre>package moe.azusebox.socket_test_app_50;<br><br>import android.os.Bundle;<br>import android.os.Handler;<br>import android.os.Message;<br>import android.support.v7.app.AppCompatActivity;<br>import android.view.View;<br>import android.widget.Button;<br>import android.widget.EditText;<br>import android.widget.TextView;<br>import android.widget.Toast;<br><br>import java.io.BufferedReader;<br>import java.io.BufferedWriter;<br>import java.io.IOException;<br>import java.io.InputStreamReader;<br>import java.io.OutputStreamWriter;<br>import java.io.PrintWriter;<br>import java.net.Socket;<br><br><br>public class MainActivity extends AppCompatActivity implements Runnable {<br><br>    //定义相关变量,完成初始化<br>    private TextView txtshow;<br>    private EditText editsend;<br>    private Button btnsend;<br>    private static final String HOST = \"45.32.20.244\";<br>    private static final int PORT = 110;<br>    private Socket socket = null;<br>    private BufferedReader in = null;<br>    private PrintWriter out = null;<br>    private String content = \"\";<br>    private StringBuilder sb = null;<br><br>    //定义一个handler对象,用来刷新界面<br>    public Handler handler = new Handler() {<br>        public void handleMessage(Message msg) {<br>            if (msg.what == 0x123) {<br>                sb.append(content);<br>                txtshow.setText(sb.toString());<br>            }<br>        }<br><br>        ;<br>    };<br><br><br>    @Override<br>    protected void onCreate(Bundle savedInstanceState) {<br>        super.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        sb = new StringBuilder();<br>        txtshow = (TextView) findViewById(R.id.txtshow);<br>        editsend = (EditText) findViewById(R.id.editsend);<br>        btnsend = (Button) findViewById(R.id.btnsend);<br><br>        //当程序一开始运行的时候就实例化Socket对象,与服务端进行连接,获取输入输出流<br>        //因为4.0以后不能再主线程中进行网络操作,所以需要另外开辟一个线程<br>        new Thread() {<br><br>            public void run() {<br>                try {<br>                    socket = new Socket(HOST, PORT);//就是这一步mmp<br>                    in = new BufferedReader(new InputStreamReader(socket.getInputStream(), \"UTF-8\"));<br>                    out = new PrintWriter(new BufferedWriter(new OutputStreamWriter(<br>                            socket.getOutputStream())), true);<br>                } catch (IOException e) {<br>                    e.printStackTrace();//而且并不会throw任何东西<br>                }<br>            }<br>        }.start();<br><br>        //为发送按钮设置点击事件<br>        btnsend.setOnClickListener(new View.OnClickListener() {<br><br>            @Override<br>            public void onClick(View v) {<br>                String msg = editsend.getText().toString();<br>                if(socket == null)<br>                {<br>                    Toast.makeText(getApplicationContext(),\"socket initiate failed, retrying\",Toast.LENGTH_SHORT).show();<br>                    new Thread() {<br><br>                        public void run() {<br>                            try {<br>                                socket = new Socket(HOST, PORT);<br>                                in = new BufferedReader(new InputStreamReader(socket.getInputStream(), \"UTF-8\"));<br>                                out = new PrintWriter(new BufferedWriter(new OutputStreamWriter(<br>                                        socket.getOutputStream())), true);<br>                            } catch (IOException e) {<br>                                e.printStackTrace();<br>                            }<br>                        }<br>                    }.start();<br>                }<br>                else<br>                {<br>                    if (socket.isConnected()) {<br>                        if (!socket.isOutputShutdown()) {<br>                            out.println(msg);<br>                        }<br>                    }<br>                }<br>            }<br>        });<br>        new Thread(MainActivity.this).start();<br>    }<br><br>    //重写run方法,在该方法中输入流的读取<br>    @Override<br>    public void run() {<br>        try {<br>            while (true) {<br>                if (socket.isConnected()) {<br>                    if (!socket.isInputShutdown()) {<br>                        if ((content = in.readLine()) != null) {<br>                            content += \"\\n\";<br>                            handler.sendEmptyMessage(0x123);<br>                        }<br>                    }<br>                }<br>            }<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        }<br>    }<br>}<br></pre></div> ","time":"2017-10-12 13:10","title":"新手写一个安卓app，用什么样的方法和服务器通信比较好？","userId":"misakaxindex","userName":"東瀬まつり太 🦋❄️🐻💎❤️🥕","userSign":"([s]安静点格子[/s])"}