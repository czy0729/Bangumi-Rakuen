{"id":405430,"avatar":"//lain.bgm.tv/pic/user/m/000/44/27/442777.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"<span style=\"color: red;\"><span style=\"font-weight:bold;\">安全警告！</span></span>本文不是说明文而是松散的记叙（吐槽）文。数据无价！请不要完全按本文所述来安装 NAS。<br><br><span style=\"font-size:10px; line-height:10px;\">本人不对可能造成的数据损坏或丢失、非技术攻击（如你的 NAS 被家长之类的收缴了）等各种可能的情况负责。</span><img src=\"/img/smiles/tv/40.gif\" smileid=\"79\" alt=\"(bgm63)\"><img src=\"/img/smiles/tv/40.gif\" smileid=\"79\" alt=\"(bgm63)\"><img src=\"/img/smiles/tv/40.gif\" smileid=\"79\" alt=\"(bgm63)\"><br><br>这年头上个网可真尼玛的难啊……<br><br><span style=\"font-size:20px; line-height:20px;\"><span style=\"font-weight:bold;\">起因</span></span><br><br>技术改造之前，自用的 NAS 是一个单盘位的 arm64 神奇玩意儿：<br><br>1. 只能安装 Armbian，一个魔改 Debian 的玩意儿，加了一堆奇怪的东西不说，还只能用社区构建版；<br>2. 更离谱的是，还只能用 Bookworm！<br>3. 热热热热热，烫烫烫烫烫，锟斤拷锟斤拷锟斤拷……磁盘温度常年居高不下，达到 88 度多，堪比吐鲁番；<br>4. arm64 主板的启动流程极为迷惑，而且没办法进行真正的全盘加密——网上的文档极为稀少，唯一能用的 LUKS 加密文档只能给存储盘加密，系统分区不行，而且为了开机自动解密，必须把密码文件明文放置在系统盘里面。<br><br>……那这加了个寂寞……<br><br>更何况，随着机器不断使用，光装不删，塞入一堆媒体文件后，磁盘终于有了些“福相”。<br><br><img src=\"https://files.catbox.moe/ynjcu8.jpg\" class=\"code\" rel=\"noreferrer\" referrerpolicy=\"no-referrer\" alt><br><br>终于，十数日之前，这机器在我 yt-dlp 和 baidupcs-go 的 24 小时激情摧残下，开始报 read-only filesystem 了，吓得我赶紧对磁盘进行 smart 检测。虽然结果表明磁盘并无大碍，但为了防止数据嗝屁，不得不开始考虑一种更安全的数据存储方案——<br><br><ul><br><li>尽可能使用自由软件，拒绝加载奇怪东西和可怕窃听软件的电子辣鸡；<br></li><li>奥卡母剃刀原则，不要 web 前端，不要花里胡哨的东西，只用 Console；<br></li><li>加密，安全又自动，从头到脚都加密；<br></li><li>拉满，一步就到位，存储容量再不愁；<br></li><li>全部跑在内网里面，禁止内网穿透，禁止（至少是禁止自动）从公网下载奇怪的东西；<br></li><li>经典古法手工，流程可追溯，控制细粒度。<br></li></ul><br><br>权衡利弊一月有余后，从某橙色网站上购买了这个土不拉稀的机器，又买了三个 14 TiB 超大磁盘，卖家说预装了一个叫 DSM 的（狗都不用）盗版系统，还信誓旦旦地保证“开箱即用”。<br><br>区区 amd64，能困难到哪儿去？一开始，我是抱着“这局要怎么输”的心态来打的。<br><br><img src=\"https://files.catbox.moe/hk8jkn.png\" class=\"code\" rel=\"noreferrer\" referrerpolicy=\"no-referrer\" alt><br><br><img src=\"https://files.catbox.moe/65lv9c.jpg\" class=\"code\" rel=\"noreferrer\" referrerpolicy=\"no-referrer\" alt><br><br><span style=\"font-size:20px; line-height:20px;\"><span style=\"font-weight:bold;\">大战主流发行版</span></span><br><br>既然这辣鸡群晖狗都不用，那第一件事儿就是找一个 Debian 把电脑里的群晖先移掉。熟练祭出 BalenaEtcher 写盘，插腚开鸡。<br><br>等会儿？为猫按 Esc 和 F12 都进不了 bios 啊！难道锁了？……bios 里咋没 UEFI Firmware Settings？<br><br>寻找一通，才知道要在 EFI Shell 里输 fwsetup 进去：<br>这？启动盘为毛叫 Netac？难道是个 USB 盘？行了先这样吧，移动盘也是盘<br><br>一通设置过后，启进安装，熟练地回车回车回车……<br><br>……安装器的代理设置为猫不管用啊！！内网明明是通的啊！（必须连接到一个通公网的代理才能拉取软件）<br>……分区工具什么鬼居然卡死了，格式化不了 ext2（启动分区）！！十分钟过去了！！<br>走流程安装了那么多次这系统，这回居然折戟沉沙……<br><br>难道是分区工具的锅……换个 Fedora 看一下？<br><br>啊尼玛，卡卡卡卡卡死了，这个机器性能怎么这么烂，淡定淡定……怎么是灰屏啊！图形安装根本启不起来！只能尝试字符 console 安装了！！<br><br>……What！只能支持基本安装！高级分区分不了！磁盘加密加不了！LVM 使用不能！……<br><br>诶，这儿有个 VNC 安装！从内网苹果鸡试着连一下……根本不行啊！<br><br>算了，转战 AOSC OS！！古法手工安装，从 tarball 开始安装，我倒看公如何应对！！……nyyyyyyyyyy……连 shell 都进不去！console login prompt 连用户名和密码都输入不了……！<br><br>算了，转战 Arch Linux，用 Arch Linux 安装 AOSC！！！<br><br>……翻出之前自己写的安装文档，蹲在地上开始照着文档输命令。<br><br>爷格盘了！……爷 lvcreate 了！……爷 cryptsetup……untar！！！！！<br><br>一顿操作猛如虎。<br><br><img src=\"https://files.catbox.moe/qua183.jpg\" class=\"code\" rel=\"noreferrer\" referrerpolicy=\"no-referrer\" alt><br><br><span style=\"color: blue;\"><span style=\"font-size:17px; line-height:17px;\"><span style=\"font-weight:bold;\">终于，卡 grub 里边儿进不去系统啦！！</span></span></span><br><br>……<br><br><span style=\"font-size:20px; line-height:20px;\"><span style=\"font-weight:bold;\">大战电脑硬件（一）</span></span><br><br>迷惑了一大圈儿，最终还是决定用回 Debian。<br><br>……安装器的代理设置为猫不管用啊！！内网明明是通的啊！（必须连接到一个通公网的代理才能拉取软件）<br>算了不管网络了强行安装！……除了基本系统之外什么都装不上去……还是装不到 Netac 盘里面！诶！LVM 分区的选项为什么没有了呀！难道真的是因为……<br><br>断电，拧螺丝打开后盖。这个机器的后盖还是比较好移掉的，只需要徒手拧掉后盖固定在后底板上的四个螺丝。开开一看差点儿吐血，一个红色的 USB 盘连着根肠子，拿螺丝上在硬盘腔的侧面。<br><br>迷惑了……现在的 NAS 设置都这么不协调吗？脑袋小小，肚子大大？<br><br>===未完待续，躺一会儿===","time":"2024-9-14 00:04","title":"有惊无险的自用 NAS 折腾记","userId":"duoduoeeee","userName":"duoduoeeee","userSign":"(风箫半举雾沉海，鸢影轻摇翼浮天)"}