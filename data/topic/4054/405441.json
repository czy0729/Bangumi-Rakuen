{"id":405441,"avatar":"//lain.bgm.tv/pic/user/m/000/71/46/714685.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"最近手机存储快满了，看了一下占用，发现大多是来自QQ的聊天图片文件，打算清理一波，但又只想清理部分群聊的，于是研究了一下，写了一个程序。原本是打算做一个app的，但是没那么多时间，就只写了一个命令行程序。<br><br>项目地址：<a href=\"https://github.com/h4ckm310n/Android-QQ-Pic-Cleaner\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://github.com/h4ckm310n/Android-QQ-Pic-Cleaner</a><br><br>需要注意的是，这个需要有root权限（要访问QQ的数据库以及聊天图片目录），且只支持旧版（非NT版本）的QQ，例如我的版本是8.9.58.11175。运行之前建议做好备份，以免出现意外导致数据丢失。<br><br><span style=\"font-size:18px; line-height:18px;\">原理</span><br>简单来讲就是读取数据库中特定对象的聊天记录，异或解密（key同样在data目录中）之后进行protobuf反序列化，得到图片的MD5，再对其CRC64得到图片文件名，具体的实现过程我参考的是<a href=\"https://github.com/QQBackup/QQ-History-Backup\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">https://github.com/QQBackup/QQ-History-Backup</a>。<br><br><span style=\"font-size:18px; line-height:18px;\">示例</span><br>（具体参数说明见GitHub页）<br><br>列出用户1234的所有好友和群聊：<br>android-qq-pic-cleaner -q 1234 -l<br><br>删除用户1234的好友2345、3456及群聊4567、5678、6789的聊天图片：<br>android-qq-pic-cleaner -q 1234 -f 2345:3456 -g 4567:5678:6789<br><br>模拟删除用户1234的好友2345的聊天图片（但实际并没有删除）：<br>android-qq-pic-cleaner -q 1234 -f 2345 --dry-run","time":"2024-9-14 11:06","title":"安卓QQ（非NT版本）清理指定好友或群的聊天图片文件（需root）","userId":"714685","userName":"h3nt4i","userSign":""}