{"id":346610,"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"<a href=\"https://bgmi.trim21.cn/\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://bgmi.trim21.cn/</a><br><span style=\"text-decoration: line-through;\">我很可爱, 请把你的bgm账号授权给我</span><br><br>如果你授权之后看到了炮姐或者502了, 站内私信我把你加入白名单<br><br>只会放下架的 或者 腾讯的 或者优酷的...<br>只存最新两集<br>主要还是看心情，因为271和b站我有会员。<br><br>这季大概就放巨人 sg0和island了<br><br>具体更新速度取决于字幕组和搬运组，如果你追求更新了立马能看到，大概不会满意吧…（<br><br>本来想等巨人的极影720p，结果等了一天也没等到， 只好拿了搬运组的1080p了<br><br>字幕（搬运）组现在酷爱hecv格式，我又不可能自己转码，难受 <br><br><img src=\"/img/smiles/bgm/16.png\" smileid=\"32\" alt=\"(bgm16)\"> 网站先搭起来了<br><br>目的是（我自己）了解一下cdn 对象存储这堆东西，<span style=\"text-decoration: line-through;\">顺便看看能不能炸出大佬来告诉我实现效果并不好不如洗洗睡</span> 实际效果倒是挺好的…<br><br>相比之下突然感觉大会员挺便宜的，一年在b站看的各种乱七八糟视频加起来怎么也超过400g了（平均每天两三个个视频<br><br>起因：追番的需求<br><br>开始的开始：<br>因为各种各样奇奇怪怪的问题，之前在找一个好用的，能自动从各个bt站爬新番然后下载的程序。本来一开始没找到想要自己写的，没想到开工两天就找到了…<br><a href=\"https://github.com/BGmi/BGmi\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://github.com/BGmi/BGmi</a><br>这是一个Python写的命令行程序，设计目的是运行在内网或者本地的情况下，从种子站爬取每季新番，然后下载订阅的番剧。<br><br>如果你对怎么使用BGmi感兴趣的话，可以看这里。本身不需要会写代码，会敲命令就可以了<br><a href=\"https://github.com/BGmi/BGmi/blob/dev/README.cn.md\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">readme</a><br><br><br>因为就快发新版了，所以请直接安装最新版本。<br>（不过这个项目并不是我想说的重点…（<br><br>大概是16年还是17年来着，我发现了这个项目（其实是当初正好看到了作者在v2上发的贴），然后一时兴起就写了个前端，这个项目就变成了Python写的爬虫本体+HTTP server，还有一个vue写的前端bgmi-frontend，我也顺便成了项目维护者之一。<br><br>然后上面吹水了这么多之后<img src=\"/img/smiles/tv/76.gif\" smileid=\"115\" alt=\"(bgm99)\">这篇文章到底是想说什么呢<br><br>是我不想跟当初设计的一样，把这个东西跑在正在我正在用的电脑上，手头又没有树莓派这样的小服务器能放在内网里，只能想办法少花钱的把他跑在公网上。程序设计之初因为是考虑放在内网或者本地，所以认为带宽不是什么问题，没有做任何这方面的考虑优化。<br><br>研究了一下发现最大的问题是带宽…<br>无论是境外还是境内的便宜服务器都难以解决这个问题，境内是贵，再加上视频文件本身码率就摆在那，对带宽的要求不低。境外服务器倒是便宜的机器也有高带宽大流量，但访问速度实在是着急…<br><br>在尝试了境外服务器+国内（腾讯云cdn）之后发现，瓶颈还是在境外服务器上。腾讯云的cdn虽然速度非常快，但是回源的速度却非常慢，在源站服务器上看只有可怜的几十kb/s，处于完全不能用的状态。<br><br>这个时候，我才发现之前经常看到倒是没有注意过的“对象存储”这个玩意。我直接下载完番剧存到腾讯的服务器上，不就不用担心回源速度的问题了嘛。<br><br>所以最后的实现是这样的。<br><br>先把番剧下回来，把文件传到cdn那边去，然后在线看的时候让用户直接从cdn拖视频文件。<br><br>首先是下载视频后上传的问题。在bgmi支持的下载方式中，deluge和aria2c都是支持在下载完成后运行一个程序的。所以简单的只要我写段代码，让他们来回调，然后把对应的番剧文件上传到对象存储去，这个问题就算解决了。<br><br>至于在线看的问题，就需要动手修改对应的代码了。<br>现在bgmi的番剧索引是从本地硬盘上搜索文件是否存在，然后把对应路径发送给前端，由前端来显示，所以这里比较简单一点，只需要修改这一处地方，把原本指向同一服务器上的文件的链接改为指向对应cdn的链接即可。<br><br><br>前端因为上面说的，不再是跑在内网上，所以vue这些原本用webpack一起打包的库还要改成引入cdn，最后编译出来的整个网页只有几十kb，原本压缩完了还有几兆大…<br><br>吐槽一下vue-notification这个库，不提供cdn引入方式，只能随着webpack一起打包…<br><br><br>网站倒是能正常运行了，正式上线（<br><br>cdn和对象存储是真的有点贵…<br><br>看了三遍巨人(倒不是因为太好看, 而因为改了几次代码), 就用掉1G的免费流量了.<br><br>一边心疼一边研究一下各家cdn和对象存储的价格... 下面是不看也不会让你损失什么的内容<span style=\"text-decoration: line-through;\">其实上面也是</span><br><br>腾讯这边平均每g流量要花的钱在0.2~0.35之间， 看的人越多单价越低（cdn利用越充分）。<br><br>七牛这边是 外网流出流量固定0.29 元/GB 10GB以内存储免费。<br><br>又拍这边价格计算比较复杂...小于日流量的存储是不要钱的， 也就是说用掉2g流量的话就有2g的免费存储可以使用。然后流量是0.29元/GB 没有免费额度<br><br>阿里云是8元40G/年 的存储 然后流量费用方面, 回源跟腾讯云一样是0.15元/GB 直接请求是0.25元/g的闲时流量(0:00-8:00) 和0.50元/g的忙时流量. cdn没有免费额度, 20元/100G起步, https还要额外收钱，40元/千万次请求起步，流量没有特别便宜https请求还用不完, 我表示打扰了…<br><br>按照回复的建议, 放弃七牛...<br>继续停留在腾讯...<br><br>嘛, 考虑了一下, 做一个用bangumi授权的登录的主页, 然后屏蔽掉比较新的用户 应该就可以避免传出去流量被刷爆了... ","time":"2018-8-3 02:30","title":"在公网上搭一个便宜的追番弹幕站 现在 大概 可以凑合看了吧b38","userId":"trim21","userName":"Trim21","userSign":""}