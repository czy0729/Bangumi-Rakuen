{"id":2199,"avatar":"//lain.bgm.tv/pic/user/m/000/00/34/3417.jpg","floor":"#1","group":"Ubuntu","groupHref":"/group/ubuntu","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/04/431.jpg","message":"硬件：<br>Intel E7300 OC 3.2G<br>AMD 4850<br>2G<br><br>软件环境：<br>Ubuntu 10.04<br>Catalyst 10.04<br>mplayer（自编译）<br><br>N卡用户请自行搜索关键字vdpau<br><br>首先你的A卡要支持UVD(Unified Video Decoder)，比较新的显卡应该都是支持到UVD2的，另外Lucid自带的ATI驱动在我的机器上不支持UVD功能。所以，上官网装最新的Catalyst 10.04，认为闭源驱动是垃圾开源驱动是神的同学请出门左转，谢谢合作。<br><br>cat /var/log/Xorg.0.log | grep UVD<br>如果输出如下字样<br>(II) fglrx(0): UVD2 feature is available<br>则表明支持驱动UVD特性。<br><br>驱动安装很简单，下载之后在终端下：<br>sudo sh ./XXXX（文件名可以用TAB来选，省得自己敲）<br><br>A卡现在在linux平台上能够进行硬解得益于intel与开源社区开发的 VA-API(Video Acceleration API)，只要安装相应的后端驱动，VA-API可以支持A卡和N卡，A卡的后端就是XvBA-video<br><br>另外，A卡现在能用的硬解方案是XvBA＋VA-API，虽然XvBA是AMD提出的Linux下的高清硬解方案，但是在XvBA提出一年后AMD仍然没有发布任何有关文档、api、或是给linux下的播放器提供补丁，XvBA有也等于没有。（掀桌~）<br><br>VA-API这个API是Intel为自己的显卡发布的API，后端则是Intel驱动。XvBA＋VA-API的方案是将Intel驱动作这个后端用 XvBA代替，测试结果也显示这个方案可以用硬解高清，但是问题在于：<br><br>1、只支持UVD2；<br>2、VA-API没有被mplayer等播放器上游收入，想尝试的时候得另行下载源码，不能直接编译mplayer svn。<br>3、phoronix论坛有关xvba＋vaapi的贴子超过60页，从贴子内容看，xvba＋vaapi解码效果不好，还有人遇到播放途中崩溃的现象。<br>4、最关键的一点，XvBA＋VA-API不是catalyst提供的，也就是说这并非AMD官方提供的高清硬解方案。<br><br>现在说A卡在Linux下真正具备高清硬解能力早了点。<br><br>说完ATI官方的催化剂，再说说ATI开源驱动的高清硬解，开源驱动在高清硬解上也不乐观。有人在maillist里问x264、vc-1硬解的情况，Alex Deucher回复说，R1xx-r5xx卡用3D引擎加速视频解码，R6xx+用UVD解码，但是目前这些都没实现。<br><a href=\"http://lists.x.org/archives/xorg-dri...ry/013670.html\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">http://lists.x.org/archives/xorg-dri...ry/013670.html</a><br><br>注：Alex Deucher是ati开源驱动的老资格开发者，目前在AMD就职。R600~R700的电源管理、3D加速代码都是他写的，evergreen(HD5000)系列驱动据说也是他单*匹马搞定的。在ddx驱动、mesa、drm开发的邮件列表中经常能看到他。<br><br>言归正传。<br><br>装完Catalyst 10.04后，下载相应平台的libva包安装，当然也可以下载源码进行安装，<a href=\"http://www.splitted-desktop.com/~gbeauchesne/\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">http://www.splitted-desktop.com/~gbeauchesne/</a>上有详细的说明。还要把 libva的开发包一并安装，因为后面编译带vaavpi扩展的mplayer要用到。请根据自己的实际情况选择。<br><br>然后下载并安装XvBA-video。安装完成后测试一下VA-API是否就绪<br>$ vainfo<br>libva: libva version 0.31.0-sds6<br>Xlib: extension “XFree86-DRI” missing on display “:0.0″.<br>libva: va_getDriverName() returns 0<br>libva: Trying to open /usr/lib/va/drivers/fglrx_drv_video.so<br>libva: va_openDriver() returns 0<br>vainfo: VA API version: 0.31<br>vainfo: Driver version: Splitted-Desktop Systems XvBA backend for VA API – 0.6.11<br>vainfo: Supported profile and entrypoints<br>VAProfileMPEG2Simple : VAEntrypointIDCT<br>VAProfileMPEG2Main : VAEntrypointIDCT<br>VAProfileH264High : VAEntrypointVLD<br>VAProfileVC1Advanced : VAEntrypointVLD<br><br>最重要的是后面输出的profile，如果有内容输出应该问题就不大了。<br><br>最后就是让mplayer来支持VA-API了，发行版自带的版本目前是不支持此特性的，所以要重新编译。<br><br>$sudo apt-get build-dep mplayer<br><br>然后下载mplayer-vaapi-latest-FULL.tar.bz2，解开后执行<br>$ ./checkout-patch-build.sh<br><br>编译完成后生成的mplayer在mplayer-vaapi目录下面。<br><br>$./mplayer -vo vaapi -va vaapi path_to_movie<br><br>如果有以下字样输出<br><br>VO: [vaapi] 1280×720 => 1280×720 H.264 VA API Acceleration<br><br>则说明硬件加速成功。<br><br>然后么，确实不稳定（有时会花屏什么的），然后么，字幕问题没解决（我找不到同时开启硬解又外挂字幕的方法）……<br><br>所以说，在Ubuntu下折腾A卡的硬解就是蛋疼的表现！娱乐活动还是在Win下省心一点呀……<br><br>另外求解决MP3乱码的问题，把TAG转换成UTF-8之后Win下又乱码了，就没有两全其美的方法吗！ ","time":"2010-5-9 08:35","title":"蛋疼，硬解","userId":"venusxx","userName":"Venusxx","userSign":"(xxsuneV)"}