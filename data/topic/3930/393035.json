{"id":393035,"avatar":"//lain.bgm.tv/pic/user/m/000/44/54/445413.jpg","floor":"#1","group":"～技术宅真可怕～","groupHref":"/group/a","groupThumb":"//lain.bgm.tv/pic/icon/m/000/00/00/11.jpg","message":"今天碰上个鬼故事，不知道该发在哪，遂贴到小组里以飨班友。<br><br>-----<br><br>在厨房擦桌子，突然间家里停电了。在我走去看电闸的时候突然又恢复了。没多想，回去继续擦桌子了。<br><br>之后，回到我屋子里，发现我的dell台式果然断电了。重新开机，发现windows恢复了全部打开的窗口，包括chrome的全部tab，包括视频的播放位置。windows terminal里的所有tab也都在。最令人惊奇的是，我terminal里的ssh session竟然没有断。<br><br>想了半天，chrome在非正常关闭的情况是可以恢复tab的，youtube也有保存播放位置的功能。这些都可以解释为在掉电前存了下来。可是如果我ssh session都没有断，那么说明起码RAM是被完全写到了硬盘里，又完全被读了出来。相当于是一个走了一个完整的hibernation过程。<br><br>可是具体这个hibernation发生在什么时候呢？我掉电以前电脑应该是在sleep。sleep过程只有RAM是正常供电的，剩下的部件都在low power mode，如果要写硬盘，起码要重新从sleep中醒过来。在电压掉下来，电源的电容完全放电结束以前是不可能完成的。<br><br>困惑之中，看到了关于<a href=\"https://devblogs.microsoft.com/oldnewthing/20110510-00/?p=10703\" target=\"_blank\" rel=\"nofollow external noopener noreferrer\" class=\"l\">hybrid sleep</a>的说法。说是，windows现在，在进入sleep的时候就已经会把RAM写到硬盘里，所以就算是中途电脑掉电了，也能恢复RAM的状态。相当于是sleep基础上又做了hibernation的准备。<br><br>所以，最可能的情况是：我去擦桌子，擦桌子的时候，就在停电的若干分钟前，电脑hybrid sleep了，我的整个RAM包括我的ssh session都被写到了硬盘里。停电恢复可以后，我打开电脑，我的整个RAM都被恢复了，包括我的ssh的tcp connection。而且在server那边我的tcp connection还没有timeout（我没有在server上设置ServerAliveInterval）。所以的session就重新连上了！<br><br>感慨。ssh有的时候很脆弱，有的时候又很坚韧。比如今天这次。<br><br>我觉得想明白这个事情对我很重要，要不然晚上没法睡好觉了。","time":"2024-1-28 04:10","title":"Windows hibernation鬼故事","userId":"tatsu_","userName":"达_","userSign":""}