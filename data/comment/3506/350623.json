[{"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#2","id":"1441170","time":"2019-5-7 20:05","userId":"trim21","userName":"Trim21","userSign":"(异端比异教徒更可恨)","message":"OAuth的授权code应该是这样。<br>你开一个http server，在你需要的时候把用户重定向到你的应用授权链接去，然后用户手动点击授权，bgm会把用户重定向回你的网站（也就是你的redirect url），你在对应的redirect url收到请求之后用服务器向bgm发一个请求，用query里面的code换取access token，换回来的access token就是这个用户对应的access token。<br>授权这一步本来就应该是由用户手动进行授权的（也就是用浏览器），不应该由你靠代码来授权，甚至用用户名密码模拟登录。<br><br>如果你开发者平台里面没写redirect url，实际http请求里面的redirect url可以随便写。如果开发者平台里面写了，就必须要两个url相同。删掉原来的重定向链接试试。<br><br>你是想要拿到自己的access token做些什么事情还是想要做一个OAuth app给别人用？前者的话可以考虑用别人现成的app获取一下自己的token。","sub":[{"avatar":"//lain.bgm.tv/pic/user/m/000/42/60/426050.jpg","floor":"#2-1","id":"1441174","time":"2019-5-7 20:33","userId":"oalvay","userName":"Oalvay","userSign":"","message":"谢谢！回复很详细，辛苦了<br><br>第一个code的问题我懂了，看来是我在干蠢事<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\">。<br>第二个问题的话，开发者平台里面有填redirect url，并且确认填的和请求里的url一模一样。删掉这个的话一样是‘The redirect URI is missing or do not match’，而且在api的文档有讲换取access token的时候redirect_uri是必填的。<br><br>然后用途的话我算前者，怎么用别人现成的app获取自己的token？"},{"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#2-2","id":"1441175","time":"2019-5-7 20:36","userId":"trim21","userName":"Trim21","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Oalvay</span> 说: 谢谢！回复很详细，辛苦了<br><br>第一个code的问题我懂了，看来是我在干蠢事。<br>第二个问题的话，开发者平台里面有填redirect url，并且确认填的和请求里的url一模一样。删掉这个的话一样是‘The...</q></div>提醒一下，目前bgm现在只有一种权限，所以应用拿到你的access token之后可以调用所有的需要access token的api。<br><br>当然我并不会这么干<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"><br>如果你信得过我的话<br><a href=\"http://bangumi-auto-tracker.trim21.cn/auth\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">http://bangumi-auto-tracker.trim21.cn/auth</a>"},{"avatar":"//lain.bgm.tv/pic/user/m/000/42/60/426050.jpg","floor":"#2-3","id":"1441178","time":"2019-5-7 21:02","userId":"oalvay","userName":"Oalvay","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Trim21</span> 说: 提醒一下，目前bgm现在只有一种权限，所以应用拿到你的access token之后可以调用所有的需要access token的api。<br><br>当然我并不会这么干<br>如果你信得过我的话<br>http://bang...</q></div>所以是说如果授权了的话，我的账号上所有信息就一览无余了？这还挺吓人的<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"><br><br>到时等暑假如果实在搞不定redirect url的话，我就开个小号来授权好了<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"><br><br>感谢大佬（鞠躬）"},{"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#2-4","id":"1441180","time":"2019-5-7 21:08","userId":"trim21","userName":"Trim21","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Oalvay</span> 说: 所以是说如果授权了的话我的账号上所有信息就一览无余了？这还挺吓人的<br>到时等暑假如果实在搞不定redirect url的话，我就开个小号来授权好了<br><br>感谢大佬（鞠躬）</q></div>如果你担心一览无余的话，api能获取到的数据并不比本来就公开在网页上的数据更多，所以本来也是一览无余的状态。比如你的评分，评价，收藏，点开你的个人主页就全部都能看到……<br><br>别人没法在网站上看到你的私密日志或者帐号密码邮箱，也没有一个api能获取或者修改你的私密日志或者账号密码邮箱。<br><br>授权别的应用的风险是别人可能会恶意修改你的评分，播放进度，收藏等等。<br><br>顺便刚刚写了一个最小的oauth应用，你可以试一试<br><br><a href=\"https://gist.github.com/Trim21/4b7dedc1a3a40da92929400f91a1cff4\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://gist.github.com/Trim21/4b7dedc1a3a40da92929400f91a1cff4</a> （github gist需要翻墙）<br><br>关于redirect_uri，我的意思是，如果应用的回调地址什么都没填的话，redirect_uri的确无论是什么都可以。意思是建议删掉应用设置里面的回调地址来解决这个问题，而不是建议你删掉请求里面的redirect_uri一项……<br><br>也许是你转跳的时候跟请求token的时候两个redirect_uri不同？我还不知道这两个不相同的情况下bgm有怎么处理。"},{"avatar":"//lain.bgm.tv/pic/user/m/000/42/60/426050.jpg","floor":"#2-5","id":"1441190","time":"2019-5-7 21:51","userId":"oalvay","userName":"Oalvay","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Trim21</span> 说: 如果你担心一览无余的话，api能获取到的数据并不比本来就公开在网页上的数据更多，所以本来也是一览无余的状态。比如你的评分，评价，收藏，点开你的个人主页就全部都能看到……<br><br>别人没法在网站上看到你的私密...</q></div>！！！用你给的代码完美运行，那我以后就用这个了，再次感谢<br><br>redirect_uri我又试了很久，现在是这样：<br>应用里：不填<br>转跳时：<a href=\"https://example-app.com/redirect\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://example-app.com/redirect</a><br>请求token时：<a href=\"https://example-app.com/redirect\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://example-app.com/redirect</a><br>结果还是missing or do not match，我已经晕了<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\">"},{"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#2-6","id":"1441192","time":"2019-5-7 21:56","userId":"trim21","userName":"Trim21","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Oalvay</span> 说: ！！！用你给的代码完美运行，那我以后就用这个了，再次感谢<br><br>redirect_uri我又试了很久，现在是这样：<br>应用里：不填<br>转跳时：https://example-app.com/redirect<br>...</q></div><span style=\"text-decoration: line-through;\">有时候可能是有typo自己看不出来，如果你还想挣扎一下的话可以考虑放一下完整代码<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\"></span><br><br>还是算了，问题解决了就好"},{"avatar":"//lain.bgm.tv/pic/user/m/000/42/60/426050.jpg","floor":"#2-7","id":"1441194","time":"2019-5-7 22:07","userId":"oalvay","userName":"Oalvay","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Trim21</span> 说: 有时候可能是有typo自己看不出来，如果你还想挣扎一下的话可以考虑放一下完整代码<br><br>还是算了，问题解决了就好</q></div>你这样一讲我突然难受<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\">，反正以后早晚用到别家的api，还是请你帮我看看好了<br><br>转跳我就纯手动了，用浏览器输入<div class=\"codeHighlight\"><pre>https://bgm.tv/oauth/authorize?response_type=code&client_id=111111111111111&redirect_uri=https://example-app.com/redirect%3A%2F%2Fbangumi.github.io%2Fapi%2Foauth2-redirect.html&state=11</pre></div><br>然后授权拿到code，接着请求token就这几行：<br><div class=\"codeHighlight\"><pre>import requests<br><br>json1 = {<br>        'grant_type' : 'authorization_code',<br>        'client_id' : '111111111111111',<br>        'code' : '111111111111111',<br>        'client_secret':'111111111111111',<br>        'redirect_uri':'https://example-app.com/redirect'<br>        }<br>r_auth = requests.post('https://bgm.tv/oauth/access_token', data = json1)<br></pre></div>"},{"avatar":"//lain.bgm.tv/pic/user/m/000/28/76/287622.jpg","floor":"#2-8","id":"1441196","time":"2019-5-7 22:15","userId":"trim21","userName":"Trim21","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Oalvay</span> 说: 你这样一讲我突然难受，反正以后早晚用到别家的api，还是请你帮我看看好了<br><br>转跳我就纯手动了，用浏览器输入https://bgm.tv/oauth/authorize?response_type=co...</q></div>你自己运行一下看一眼输出就知道了<br><br><div class=\"codeHighlight\"><pre><br>if __name__ == '__main__':<br><br>    import urllib.parse<br>    url_obj: urllib.parse.ParseResult = urllib.parse.urlparse(<br>        'https://bgm.tv/oauth/authorize?response_type=code&client_id'<br>        '=111111111111111&redirect_uri=https://example-app.com/redirect'<br>        '%3A%2F%2Fbangumi.github.io%2Fapi%2Foauth2-redirect.html&state=11'<br>    )<br>    print(urllib.parse.parse_qs(url_obj.query))<br><br></pre></div>"},{"avatar":"//lain.bgm.tv/pic/user/m/000/42/60/426050.jpg","floor":"#2-9","id":"1441199","time":"2019-5-7 22:25","userId":"oalvay","userName":"Oalvay","userSign":"","message":"<div class=\"quote\"><q><span style=\"font-weight:bold;\">Trim21</span> 说: 你自己运行一下看一眼输出就知道了<br><br><br>if __name__ == '__main__':<br><br>&nbsp; &nbsp; import urllib.parse<br>&nbsp; &nbsp; url_o...</q></div>我也刚发现了<img src=\"/img/smiles/tv/15.gif\" smileid=\"54\" alt=\"(bgm38)\">，转跳原来一直用的是<a href=\"https://example-app.com/redirect%3A%2F%2Fbangumi.github.io%2Fapi%2Foauth2-redirect.html\" target=\"_blank\" rel=\"nofollow external noopener\" class=\"l\">https://example-app.com/redirect ... auth2-redirect.html</a>，那这样就完美解决了。<br><br>非常极其特别感谢。<br><br>～技术宅真可怕～小组 ×<br>stackoverflow中文版  √"}]}]